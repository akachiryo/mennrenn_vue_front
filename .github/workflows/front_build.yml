name: front push and build

on:
  push:
    branches: [main]

jobs:
  front1-push-and-build:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        os: [latest]
        node: [16.13.2]
    steps:
    - uses: actions/setup-node@v2-beta
      with:
        node-version: ${{ matrix.node }}
        
    - name: Checkout
    - uses: actions/checkout@v2

    - name: Cache node_modules
      id: node_modules_cache_id
      uses: actions/cache@v2　// 1
      with:
        path: node_modules
        key: ${{ matrix.os }}-node-v${{ matrix.node }}-deps-${{ hashFiles(format('{0}{1}', github.workspace, '/yarn.lock')) }}

    - name: Install
      if: steps.node_modules_cache_id.outputs.cache-hit != 'true'　// 2
      run: yarn --check-files --frozen-lockfile --non-interactive
        
    - name: Deploy
      env:
        PRIVATE_KEY: ${{ secrets.PRIVATE_KEY }}
        USER_NAME: ${{ secrets.USER_NAME }}
        HOST_NAME_ONE: ${{ secrets.HOST_NAME_ONE }}
      run: |
        echo "$PRIVATE_KEY" > private_key && chmod 600 private_key
        ssh -o StrictHostKeyChecking=no -i private_key ${USER_NAME}@${HOST_NAME_ONE} 'cd mennrenn_vue_front &&
        git pull origin main &&
        cd front &&
        yarn build'
